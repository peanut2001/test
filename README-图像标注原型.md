# 医学AI图像标注原型系统

## 概述

这是一个基于HTML+CSS+JavaScript开发的医学AI图像标注原型系统，实现了您提出的三栏布局设计和图像标注功能需求。

## 功能特性

### 🎯 核心功能

1. **三栏布局设计**
   - 左栏：任务输入区（临床问题输入 + 图像上传）
   - 中栏：AI响应与编辑区（影像展示 + 标注工具 + AI分析结果）
   - 右栏：历史记录与设置

2. **图像上传与管理**
   - 支持点击上传和拖拽上传
   - 支持多种格式：JPG, PNG, DICOM等
   - 缩略图预览和切换
   - 图像删除功能

3. **智能标注工具**
   - 🖱️ 选择工具：默认选择模式
   - ⬜ 矩形标注：框选病灶区域
   - ➡️ 箭头指向：指向特定特征
   - 📝 文本标签：添加文字说明
   - 🖊️ 画笔轮廓：勾勒不规则形状（预留）

4. **标注管理**
   - 自动编号：每个标注自动分配唯一ID
   - 标注列表：显示所有标注项
   - 交互高亮：鼠标悬停时高亮对应标注
   - 编辑删除：支持标注的编辑和删除

5. **AI分析功能**
   - 模拟AI思考过程
   - 生成结构化诊断建议
   - 标注引用：文本中自动关联图像标注
   - 交互联动：点击文本标注引用时高亮对应图像区域

### 🔗 标注关联机制

系统实现了图片标注与文本的自动编号关联机制：

1. **自动编号**：每个标注自动获得唯一ID（如 #1, #2, #3）
2. **文本引用**：AI分析结果中自动插入标注引用（如 [影像-标注#1]）
3. **交互高亮**：
   - 鼠标悬停文本引用 → 图像标注高亮
   - 鼠标悬停图像标注 → 标注列表项高亮
   - 点击文本引用 → 滚动到对应标注列表项

## 智能工作流程 🔄

系统采用**AI先分析，医生后确认**的智能工作模式：

### 1. 输入临床问题（可选）
在左栏的文本框中输入患者的临床症状描述。

### 2. 上传医学图像
- 点击"上传影像/报告"按钮选择文件
- 或直接拖拽图像文件到上传区域
- 支持上传多张图像

### 3. AI自动分析与标注 🤖
**上传图像后，AI会立即：**
1. 自动分析图像内容
2. 识别可疑区域和关键特征
3. 在图像上自动添加建议标注（蓝色虚线框）
4. 生成初步的AI分析报告

### 4. 医师确认与调整 👨‍⚕️
**您可以对AI建议进行：**
- ✅ **确认AI标注**：点击标注列表中的"✓"按钮确认AI建议
- ✏️ **调整标注位置**：删除AI标注后重新标注
- ➕ **添加新标注**：使用标注工具添加AI遗漏的区域
- ❌ **删除不准确的标注**：删除AI错误识别的区域

### 5. 标注工具使用
- **矩形标注**：按住鼠标拖拽绘制矩形框
- **箭头标注**：点击图像位置放置箭头
- **文本标注**：点击位置后输入文本内容

### 6. 重新分析（可选）
如果您修改了标注，可以点击"重新分析"按钮，AI会：
1. 基于更新的标注重新分析
2. 生成更准确的诊断建议
3. 更新标注引用关系

### 7. 查看分析结果
- **思考区域**：显示AI的分析思路，区分AI识别和医师标注
- **回答区域**：显示最终的诊断建议
- **标注引用**：文本中的标注引用可以与图像标注交互
  - `[AI-标注#X]`：AI建议的标注（蓝色）
  - `[医师-标注#X]`：医师确认的标注（绿色）

## 标注样式说明

### AI建议标注 🤖
- **颜色**：蓝色（#2196F3）
- **样式**：虚线边框
- **标识**：AI1, AI2, AI3...
- **操作**：可确认、删除

### 医师标注 👨‍⚕️
- **颜色**：绿色（#4CAF50）
- **样式**：实线边框
- **标识**：#1, #2, #3...
- **操作**：可编辑、删除

## 技术实现

### 前端技术栈
- **HTML5**：页面结构
- **CSS3**：样式设计和响应式布局
- **JavaScript ES6**：交互逻辑和标注功能
- **Canvas API**：图像标注绘制
- **File API**：文件上传处理

### 核心类设计
```javascript
class ImageAnnotationSystem {
    // 主要属性
    - currentTool: 当前选择的标注工具
    - annotations: 所有标注数据
    - uploadedImages: 上传的图像列表
    - canvas/ctx: Canvas绘图上下文

    // 主要方法
    - handleFileUpload(): 处理文件上传
    - showImage(): 显示指定图像
    - addAnnotation(): 添加新标注
    - drawAnnotation(): 绘制标注
    - updateAnnotationList(): 更新标注列表
    - generateAIResponse(): 生成AI分析结果
    - enableAnnotationReferences(): 启用标注引用交互
}
```

### 数据结构
```javascript
// 标注数据结构
{
    id: 1,                    // 唯一标识
    type: 'rectangle',        // 标注类型
    startX: 100, startY: 50,  // 起始坐标
    endX: 200, endY: 150,     // 结束坐标
    text: '可疑结节',          // 文本内容（文本标注）
    imageIndex: 0             // 所属图像索引
}
```

## 响应式设计

系统支持多种屏幕尺寸：
- **桌面端**（>1200px）：完整三栏布局
- **平板端**（768px-1200px）：调整栏宽比例
- **移动端**（<768px）：垂直堆叠布局

## 文件结构

```
image-annotation-prototype.html  # 主要原型文件
README-图像标注原型.md          # 使用说明文档
```

## 扩展建议

1. **后端集成**：连接真实的AI模型API
2. **数据持久化**：保存标注数据到数据库
3. **用户权限**：添加用户登录和权限管理
4. **导出功能**：支持标注数据和报告导出
5. **协作功能**：多用户协作标注
6. **更多标注工具**：椭圆、多边形、测量工具等

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 注意事项

1. 这是一个原型系统，AI分析功能为模拟实现
2. 图像处理基于前端Canvas，大图像可能影响性能
3. 标注数据仅保存在浏览器内存中，刷新页面会丢失
4. 建议使用现代浏览器以获得最佳体验

---

**开发完成时间**：2025年7月2日
**技术栈**：HTML5 + CSS3 + JavaScript ES6
**设计模式**：面向对象编程 + 事件驱动架构
